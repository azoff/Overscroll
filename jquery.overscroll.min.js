/*

 Overscroll v1.5.1.1
 A jQuery Plugin that emulates the iPhone scrolling experience in a browser.
 http://azoffdesign.com/overscroll

 Intended for use with the latest jQuery
 http://code.jquery.com/jquery-latest.js

 Copyright 2011, Jonathan Azoff
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license

 For API documentation, see the README file
 http://azof.fr/pYCzuM

 Date: Wednesday, December 7th 2011
*/
(function(a,b,c,d,e){"use strict";e="ontouchstart"in a;d=c.fn.overscroll=function(a){a=a||{};return this.each(function(){d.init(c(this),a)})};c.fn.removeOverscroll=function(a){return this.each(function(){var a=c(this).data(d.removerKey);if(c.isFunction(a)){a()}})};c.extend(d,{events:{wheel:"mousewheel DOMMouseScroll",start:"mousedown",drag:"mousemove",end:"mouseup mouseleave click",scroll:"scroll",ignored:"select dragstart drag"},div:"<div/>",removerKey:"overscroll-remover",constants:{driftFrequency:40,driftSequences:22,driftDecay:1.15,driftTimeout:100,timeout:400,captureThreshold:3,wheelDelta:20,scrollDelta:15,thumbThickness:6,thumbOpacity:.7},init:function(a,f){var g={sizing:d.getSizing(a),cursors:d.getCursors(),flags:{},cleaned:{}};g.options=f=c.extend({showThumbs:true,persistThumbs:false,wheelDirection:"vertical",wheelDelta:d.constants.wheelDelta,scrollDelta:d.constants.scrollDelta,direction:"multi",cancelOn:"",zIndex:999},f);if(f.direction!=="multi"&&f.direction!==f.wheelDirection){f.wheelDirection=f.direction}f.scrollDelta=b.abs(f.scrollDelta);f.wheelDelta=b.abs(f.wheelDelta);a.removeOverscroll();a.data(d.removerKey,d.remover(a,g));if(e){a.css({overflow:"auto","-webkit-overflow-scrolling":"touch","-moz-overflow-scrolling":"touch","overflow-scrolling":"touch"})}else{g.target=a.css({position:"relative",overflow:"hidden",cursor:g.cursors.grab}).on(d.events.wheel,g,d.wheel).on(d.events.start,g,d.start).on(d.events.end,g,d.stop).on(d.events.scroll,g,d.scroll).on(d.events.ignored,false);if(f.showThumbs){g.thumbs={};if(g.sizing.container.scrollWidth>0&&f.direction!=="vertical"){g.thumbs.horizontal=c(d.div).css(d.getThumbCss(g.sizing.thumbs.horizontal,g.options.zIndex)).css({opacity:f.persistThumbs?d.constants.thumbOpacity:0});a.prepend(g.thumbs.horizontal)}if(g.sizing.container.scrollHeight>0&&f.direction!=="horizontal"){g.thumbs.vertical=c(d.div).css(d.getThumbCss(g.sizing.thumbs.vertical,g.options.zIndex)).css({opacity:f.persistThumbs?d.constants.thumbOpacity:0});a.prepend(g.thumbs.vertical)}}}if(f.scrollLeft){a.scrollLeft(f.scrollLeft)}if(f.scrollTop){a.scrollTop(f.scrollTop)}d.moveThumbs(g,a.scrollLeft(),a.scrollTop())},getCursors:function(){var a={};if(c.browser.mozilla){a.grab="-moz-grab";a.grabbing="-moz-grabbing"}else if(c.browser.webkit){a.grab="-webkit-grab";a.grabbing="-webkit-grabbing"}else{a.grab=a.grabbing="move"}return a},remover:function(a,b){return function(){a.removeAttr("style").removeData(d.removerKey).off(d.events.wheel,d.wheel).off(d.events.start,d.start).off(d.events.end,d.stop).off(d.events.ignored,false);if(b.thumbs){if(b.thumbs.horizontal){b.thumbs.horizontal.remove()}if(b.thumbs.vertical){b.thumbs.vertical.remove()}}}},triggerEvent:function(a,b){b.target.trigger("overscroll:"+a)},toggleThumbs:function(a,b){if(a.thumbs&&!a.options.persistThumbs){if(b){if(a.thumbs.vertical){a.thumbs.vertical.stop(true,true).fadeTo("fast",d.constants.thumbOpacity)}if(a.thumbs.horizontal){a.thumbs.horizontal.stop(true,true).fadeTo("fast",d.constants.thumbOpacity)}}else{if(a.thumbs.vertical){a.thumbs.vertical.fadeTo("fast",0)}if(a.thumbs.horizontal){a.thumbs.horizontal.fadeTo("fast",0)}}}},setPosition:function(a,b,c){b.x=a.pageX;b.y=a.pageY;b.time=d.time();b.index=c;return b},wheel:function(b,c){var e=b.data,f=b.originalEvent;b.preventDefault();d.clearInterval(e.target);if(f.wheelDelta){c=f.wheelDelta/(a.opera?-120:120)}if(f.detail){c=-f.detail/3}if(!e.wheelCapture){e.wheelCapture={timeout:null};d.toggleThumbs(e,true);e.target.stop(true,e.flags.dragging=true)}c*=e.options.wheelDelta;if(e.options.wheelDirection==="horizontal"){this.scrollLeft-=c}else{this.scrollTop-=c}d.moveThumbs(e,this.scrollLeft,this.scrollTop);if(e.wheelCapture.timeout){a.clearTimeout(e.wheelCapture.timeout)}e.wheelCapture.timeout=a.setTimeout(function(a){d.toggleThumbs(e,e.wheelCapture=e.flags.dragging=null)},d.constants.timeout)},moveThumbs:function(a,b,c){var d,e,f,g;if(a.options.showThumbs){d=a.thumbs;e=a.sizing;if(d.horizontal){f=b*(1+e.container.width/e.container.scrollWidth);g=c+e.thumbs.horizontal.top;d.horizontal.css("margin",g+"px 0 0 "+f+"px")}if(d.vertical){f=b+e.thumbs.vertical.left;g=c*(1+e.container.height/e.container.scrollHeight);d.vertical.css("margin",g+"px 0 0 "+f+"px")}}},start:function(a){var b=a.data,e=b.target,f=b.flags;d.clearInterval(b.target);b.startTarget=c(a.target);if(!b.startTarget.is(b.options.cancelOn)){a.preventDefault();b.target.css("cursor",b.cursors.grabbing);f.dragging=f.dragged=false;e.bind(d.events.drag,b,d.drag).stop(true,true);b.position=d.setPosition(a,{});b.capture=d.setPosition(a,{},2);d.triggerEvent("dragstart",b)}},drag:function(a){a.preventDefault();var b=a.data,c=b.flags;if(!c.dragged){d.toggleThumbs(b,true)}c.dragged=true;if(b.options.direction!=="vertical"){this.scrollLeft-=a.pageX-b.position.x}if(b.options.direction!=="horizontal"){this.scrollTop-=a.pageY-b.position.y}d.moveThumbs(b,this.scrollLeft,this.scrollTop);d.setPosition(a,b.position);if(--b.capture.index<=0){c.dragging=true;d.setPosition(a,b.capture,d.constants.captureThreshold)}},time:function(){return(new Date).getTime()},deferClick:function(a){var b=a.data("events");b=b&&b.click?b.click.slice():false;a.unbind("click").one("mouseup",function(){if(b){c.each(b,function(b,c){a.click(c)})}return false})},stop:function(a){var b=a.data,e=b.target,f=b.flags;e.unbind(d.events.drag,d.drag);if(b.position){d.triggerEvent("dragend",b);if(f.dragging){d.drift(this,a,function(){d.toggleThumbs(b,f.dragging=false)})}else{d.toggleThumbs(b,false)}if(f.dragged&&c(a.target).is(b.startTarget)){d.deferClick(b.startTarget);b.startTarget=f.dragged=null}b.capture=b.position=undefined}b.target.css("cursor",b.cursors.grab)},scroll:function(a){var b=a.data,c=b.flags;if(!c.dragging){d.moveThumbs(b,this.scrollLeft,this.scrollTop)}},clearInterval:function(b){b=c(b);var d=b.data("overscroll-interval");if(d){a.clearInterval(d)}b.data("overscroll-interval",null)},setInterval:function(a,b){d.clearInterval(a);c(a).data("overscroll-interval",b)},drift:function(b,c,e){var f=c.data,g,h,i,j,k=b.scrollLeft,l=b.scrollTop,m=d.constants.driftDecay;if(d.time()-f.capture.time>d.constants.driftTimeout){return e.call(null,f)}g=f.options.scrollDelta*(c.pageX-f.capture.x);h=f.options.scrollDelta*(c.pageY-f.capture.y);i=g/d.constants.driftSequences;j=h/d.constants.driftSequences;if(f.options.direction!=="vertical"){k-=g}if(f.options.direction!=="horizontal"){l-=h}d.triggerEvent("driftstart",c.data);d.setInterval(b,a.setInterval(function(){var a=true,c=1,g=-1;if(j>c&&b.scrollTop>l||j<g&&b.scrollTop<l){a=false;b.scrollTop-=j;j/=m}if(i>c&&b.scrollLeft>k||i<g&&b.scrollLeft<k){a=false;b.scrollLeft-=i;i/=m}d.moveThumbs(f,b.scrollLeft,b.scrollTop);if(a){d.clearInterval(b);d.triggerEvent("driftend",f);e.call(null,f)}},d.constants.driftFrequency))},getSizing:function(a){var b={},c=a.get(0);a=b.container={width:a.width(),height:a.height()};a.scrollWidth=a.width>=c.scrollWidth?a.width:c.scrollWidth;a.scrollHeight=a.height>=c.scrollHeight?a.height:c.scrollHeight;b.thumbs={horizontal:{width:a.width*a.width/a.scrollWidth,height:d.constants.thumbThickness,corner:d.constants.thumbThickness/2,left:0,top:a.height-d.constants.thumbThickness},vertical:{width:d.constants.thumbThickness,height:a.height*a.height/a.scrollHeight,corner:d.constants.thumbThickness/2,left:a.width-d.constants.thumbThickness,top:0}};return b},getThumbCss:function(a,b){return{position:"absolute","background-color":"black",width:a.width+"px",height:a.height+"px",margin:a.top+"px 0 0 "+a.left+"px","-moz-border-radius":a.corner+"px","-webkit-border-radius":a.corner+"px","border-radius":a.corner+"px","z-index":b}}})})(window,Math,jQuery)